{{/* renovate: depName=kube-vip repoUrl=https://kube-vip.github.io/helm-charts */}}
{{- $version := "0.4.4" -}}

{{- $firstNIC := (index .State.system.network 0).name -}}

{{- with .Config -}}
apiVersion: v1
kind: Namespace
metadata:
  name: kube-vip
---
apiVersion: helm.cattle.io/v1
kind: HelmChart
metadata:
  name: kube-vip
  namespace: kube-system
spec:
  chart: kube-vip
  repo: https://kube-vip.github.io/helm-charts
  targetNamespace: kube-vip
  version: "{{ default "0.4.4" .kubevip.version }}"
  valuesContent: |-
    config:
      address: "{{ .kubevip.eip }}"
    env:
      vip_interface: "{{ default $firstNIC .kubevip.interface }}"
      cp_enable: "true"
{{- end -}}
